/*********************************************************************
Dimmer Board (with Master Fader)
**********************************************************************/

#include <Arduino.h>
#include <TeensyDmx.h>

#define DMX_REDE 24

TeensyDmx Dmx(Serial1, DMX_REDE);

byte dmxVal[9];
float scalerVal;

void setup() {
  analogReadRes(8);
  Dmx.setMode(TeensyDmx::DMX_OUT);  // Teensy DMX Declaration of Output
}

void loop() {
  scalerVal = (floatmap(analogRead(9), 1, 1024, 1024, 1) / 1024);  // Master Fader_______________________________
  
  for (int i = 0; i < 8; ++i) {   // Channel Fader 1-8__________________________
    dmxVal[i] = round(floatmap(analogRead(i+1), 1, 1024, 255, 1) * scalerVal);
    Dmx.setDmxChannel((i+1), dmxVal[i]);
  }
}

float floatmap(float x, float in_min, float in_max, float out_min, float out_max)  { // function for mapping floats
  return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
}
